<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Importación y exportación de datos &mdash; Curso PostGIS &amp; GeoNetwork 1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Curso PostGIS &amp; GeoNetwork 1 documentation" href="index.html" />
    <link rel="next" title="Análisis espacial" href="analisis_espacial.html" />
    <link rel="prev" title="Indexación espacial" href="indexacion_espacial.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="analisis_espacial.html" title="Análisis espacial"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="indexacion_espacial.html" title="Indexación espacial"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Curso PostGIS &amp; GeoNetwork 1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="importacion-y-exportacion-de-datos">
<h1>Importación y exportación de datos<a class="headerlink" href="#importacion-y-exportacion-de-datos" title="Permalink to this headline">¶</a></h1>
<p>En este tema nos introduciremos en el uso de herramientas de importación/exportación de datos hasta/desde PostGIS. Se realizará la importación con archivos de tipo ESRI ShapeFile y con datos descargados de OpenStreetMap. Para realizar estos procesos, se dispondrá de herramientas como <tt class="docutils literal"><span class="pre">shp2pgsql</span></tt> que vienen incluidas en PostGIS o se utilizarán otras como <tt class="docutils literal"><span class="pre">osmosis</span></tt> u <tt class="docutils literal"><span class="pre">osm2pgsql</span></tt> descargadas desde los repositorios.</p>
<div class="section" id="importacion-esri-shapes-mediante-shp2pgsql">
<h2>Importación ESRI shapes mediante shp2pgsql<a class="headerlink" href="#importacion-esri-shapes-mediante-shp2pgsql" title="Permalink to this headline">¶</a></h2>
<p>El cargador <tt class="docutils literal"><span class="pre">shp2pgsql</span></tt> convierte archivos ESRI Shape en SQL preparado para la inserción en la base de datos. Se utiliza desde la linea de comandos, aunque existe una versión con interfaz gráfica para el sistema operativo Windows. Se puede acceder a la ayuda de la herramienta mediante:</p>
<div class="highlight-python"><pre>$ shp2pgsql -?</pre>
</div>
<p>Para el uso de la herramienta:</p>
<div class="highlight-python"><pre>$ shp2pgsql [&lt;opciones&gt;] &lt;ruta_shapefile&gt; [&lt;esquema&gt;.]&lt;tabla&gt;</pre>
</div>
<p>entre las opciones encontraremos:</p>
<blockquote>
<div><ul>
<li><p class="first"><strong>-s &lt;srid&gt;</strong>  Asigna el sistema de coordenadas. Por defecto será -1</p>
</li>
<li><dl class="first docutils">
<dt><strong>(-d|a|c|p)</strong></dt>
<dd><ul class="first last simple">
<li><em>-d</em>  Elimina la tabla, la recrea y la llena con los datos del shape</li>
<li><em>-a</em>  Llena la tabla con los datos del shape. Debe tener el mismo esquema exactamente</li>
<li><em>-c</em>  Crea una nueva tabla y la llena con los datos. opción por defecto.</li>
<li><em>-p</em>  Modo preparar, solo crea la tabla</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><strong>-g &lt;geocolumn&gt;</strong> Especifica el nombre de la columna geometría (usada habitualmente en modo <em>-a</em>)</p>
</li>
<li><p class="first"><strong>-D</strong> Usa el formato Dump de postgresql</p>
</li>
<li><p class="first"><strong>-G</strong> Usa tipo geogrfía, requiere datos de longitud y latitud</p>
</li>
<li><p class="first"><strong>-k</strong> Guarda los identificadores en postgresql</p>
</li>
<li><p class="first"><strong>-i</strong> Usa int4 para todos los campos integer del dbf</p>
</li>
<li><p class="first"><strong>-I</strong> Crea un índice spacial en la columna de la geometría</p>
</li>
<li><p class="first"><strong>-S</strong> Genera geometrías simples en vez de geometrías MULTI</p>
</li>
<li><p class="first"><strong>-w</strong> Salida en WKT</p>
</li>
<li><p class="first"><strong>-W &lt;encoding&gt;</strong> Especifica la codificación de los caracteres. (por defecto : &#8220;WINDOWS-1252&#8221;).</p>
</li>
<li><p class="first"><strong>-N &lt;policy&gt;</strong> estrategia de manejo de geometrías NULL (insert*,skip,abort).</p>
</li>
<li><p class="first"><strong>-n</strong>  Solo importa el archivo DBF</p>
</li>
<li><p class="first"><strong>-?</strong>  Muestra la ayuda</p>
</li>
</ul>
</div></blockquote>
<div class="section" id="practica">
<h3>Práctica<a class="headerlink" href="#practica" title="Permalink to this headline">¶</a></h3>
<p>Realice la importación de los datos de la carpeta <tt class="docutils literal"><span class="pre">Curso/datos/Costa</span> <span class="pre">Rica/shp</span></tt> en la base de datos <tt class="docutils literal"><span class="pre">curso</span></tt>.</p>
<blockquote>
<div><p>La importación ha de realizarse en un esquema que se llame <tt class="docutils literal"><span class="pre">gis</span></tt>.</p>
<p>Debe crear un índice para cada columna geométrica que se llamará <tt class="docutils literal"><span class="pre">geom</span></tt>.</p>
<p>Debe comprobar el sistema de coordenadas en el que están los datos y asignarselo en la importación.</p>
<p>Si tiene problemas con la codificación de los datos revise esta en su base de datos y modifiquela si es necesario.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"># update pg_database set encoding=8 where datname=&#8217;base_de_datos&#8217;</p>
</div>
<a class="reference internal image-reference" href="_images/encoding.png"><img alt="_images/encoding.png" src="_images/encoding.png" /></a>
<p>Comprobar que se ha actualizado correctamente la tabla <tt class="docutils literal"><span class="pre">geometry_columns</span></tt></p>
</div></blockquote>
</div>
</div>
<div class="section" id="exportacion-desde-pg-a-archivos-de-tipo-esri-shapefile">
<h2>Exportación desde PostGIS a archivos de tipo ESRI Shapefile<a class="headerlink" href="#exportacion-desde-pg-a-archivos-de-tipo-esri-shapefile" title="Permalink to this headline">¶</a></h2>
<p>Para este proceso utilizaremos la herramienta <tt class="docutils literal"><span class="pre">pgsql2shp</span></tt>. Con ella podremos convertir los datos de nuestra base de datos en archivos ESRI Shape. Igual que para el caso anterior, la herramienta se utilizará desde la linea de comandos:</p>
<div class="highlight-python"><pre>     $ pgsql2shp [&lt;opciones&gt;] &lt;basedatos&gt; [&lt;esquema&gt;.]&lt;tabla&gt;
$ pgsql2shp [&lt;opciones&gt;] &lt;basedatos&gt; &lt;consulta&gt;</pre>
</div>
<p>las opciones serán:</p>
<div class="highlight-python"><pre>* **-f &lt;nombrearchivo&gt;**  Especifica el nombre del archivo a crear
* **-h &lt;host&gt;**  Indica el servidor donde realizará la conexión
* **-p &lt;puerto&gt;**  Permite indicar el puerto de la base de datos
* **-P &lt;password&gt;**  Contraseña
* **-u &lt;user&gt;** Usuario
* **-g &lt;geometry_column&gt;** Columna de geometría que será exportada</pre>
</div>
<div class="section" id="id1">
<h3>Práctica<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">TODO</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="gdal-ogr">
<h2>GDAL/OGR<a class="headerlink" href="#gdal-ogr" title="Permalink to this headline">¶</a></h2>
<p>GDAL/OGR es una librería de lectura y escritura de formatos geoespaciales, tanto <em>Raster</em> con GDAL como <em>Vectorial</em> con OGR. Se trata de una librería de software libre ampliamente utilizada.</p>
<div class="section" id="ogrinfo">
<h3>ogrinfo<a class="headerlink" href="#ogrinfo" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">ogrinfo</span></tt> obtiene información de los datos vectoriales. Podremos utilizar esta herramienta para la obtención de esta información de las tablas que tenemos almacenadas en la base de datos. El uso se realiza a través de la consola:</p>
<div class="highlight-python"><pre>$ ogrinfo [&lt;opciones&gt;] &lt;ruta fuente datos&gt;</pre>
</div>
<p>Entre las opciones destacaremos:</p>
<div class="highlight-python"><pre>* **-where** muestra los datos de las filas que cumplan la clausula
* **-sql** filtra la información mediante consultas SQL
* **-geom={YES/NO/SUMMARY}** modifica la visualización de la información de la columna geométrica</pre>
</div>
<p>Para utilizar <tt class="docutils literal"><span class="pre">ogrinfo</span></tt> contra nuestra base de datos, debemos utilizar la opción <tt class="docutils literal"><span class="pre">PG:</span></tt> indicandole la cadena de conexión:</p>
<div class="highlight-python"><pre>$ ogrinfo PG:"host=localhost user=usuario dbname=basedatos password=contraseña"</pre>
</div>
<p>seguidamente incluiremos cualquiera de las opciones anteriores. De esta manera por ejemplo podremos indicar:</p>
<div class="highlight-python"><pre>$ ogrinfo PG:"host=localhost user=usuario dbname=basedatos password=contraseña" -sql "&lt;una consulta&gt;" &lt;fuente de datos&gt;</pre>
</div>
</div>
<div class="section" id="ogr2ogr">
<h3>ogr2ogr<a class="headerlink" href="#ogr2ogr" title="Permalink to this headline">¶</a></h3>
<p>OGR es capaz de convertir a PostGIS todos los formatos que maneja, y será capaz de exportar desde PostGIS todos aquellos en los que tiene permitida la escritura. Ejecutando:</p>
<div class="highlight-python"><pre>$ ogr2ogr --formats</pre>
</div>
<p>podremos comprobar los formatos que maneja la herramienta. La étiqueta <tt class="docutils literal"><span class="pre">write</span></tt> nos indica si podemos crear este tipo de formatos. Hemos de tener en cuenta el formato de salida para poder manejar los parametros especiales de cada formato.</p>
<p>En la página principal de GDAL podremos encontrar un listado de todas las opciones que nos permite manejar el comando. Detallamos a continuación algunas de las principales:</p>
<blockquote>
<div><ul class="simple">
<li><strong>-select &lt;lista de campos&gt;</strong> lista separada por comas que indica la lista de campos de la capa de origen que se quiere exportar</li>
<li><strong>-where &lt;condición&gt;</strong> consulta a los datos de origen</li>
<li><strong>-sql</strong> posibilidad de insertar una consulta más compleja</li>
</ul>
</div></blockquote>
<p>Otras opciones en referencia al formato de destino (las anteriores hacían referencia al de origen):</p>
<blockquote>
<div><ul class="simple">
<li><strong>-f &lt;driver ogr&gt;</strong> formato del fichero de salida</li>
<li><strong>-lco VARIABLE=VALOR</strong> Variables propias del driver de salida</li>
<li><strong>-a_srs &lt;srid&gt;</strong> asigna el SRID especificado a la capa de salida</li>
<li><strong>-t_srs &lt;srid&gt;</strong> Reproyecta la capa de salida según el SRID especificado</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="importacion-datos-osm-a-postgis">
<h2>Importación datos OSM a PostGIS<a class="headerlink" href="#importacion-datos-osm-a-postgis" title="Permalink to this headline">¶</a></h2>
<p>OpenStreetMap (también conocido como OSM) es un proyecto colaborativo para crear mapas libres y editables.</p>
<p>Los mapas se crean utilizando información geográfica capturada con dispositivos GPS móviles, ortofotografías y otras fuentes libres. Esta cartografía, tanto las imágenes creadas como los datos vectoriales almacenados en su base de datos, se distribuye bajo licencia abierta Open Database Licence (ODbL).</p>
<p>OSM dispone de un modelo de datos particular que no responde al modelo característico de los SIG. Este está compuesto de:</p>
<blockquote>
<div><ul class="simple">
<li>Node</li>
<li>Way</li>
<li>Relation</li>
</ul>
</div></blockquote>
<p>a diferencia de las geometrías características como:</p>
<blockquote>
<div><ul class="simple">
<li>Punto</li>
<li>Linea</li>
<li>Poligono</li>
</ul>
</div></blockquote>
<p>una característica particular es la ausencia de polígonos dentro del modelo, estos se realizan mediante la asignación de una relación a una linea cerrada. Esta particularidad no impide que los datos de OSM puedan ser adaptados al modelo de geometrías normal mediante cargadores de datos OSM. A continuación se presentan dos de los más utilizados</p>
<div class="section" id="osm2pgsql">
<h3>osm2pgsql<a class="headerlink" href="#osm2pgsql" title="Permalink to this headline">¶</a></h3>
<p>Mediante el uso de este programa podremos incorporar en nuestra base de datos los datos obtenidos desde OSM. Una vez que hemos realizado la importación, aparecerán en nuestra base de datos las tablas que serán el resultado de esta importación:</p>
<blockquote>
<div><ul class="simple">
<li><em>planet_osm_point</em></li>
<li><em>planet_osm_line</em></li>
<li><em>planet_osm_polygon</em></li>
<li><em>planet_osm_roads</em></li>
</ul>
</div></blockquote>
<p>Al disponer el modelo de OSM de cientos de etiquetas, la importación crea en las tablas un gran número de campos de los que la mayoría tendrán valor NULL.</p>
<p>La ejecución se realiza desde la consola:</p>
<div class="highlight-python"><pre>$ osm2pgsql [opciones] ruta_fichero.osm otro_fichero.osm
$ osm2pgsql [opciones] ruta_planet.[gz, bz2]</pre>
</div>
<p>algunas de las opciones se detallan a continuación:</p>
<blockquote>
<div><ul class="simple">
<li><em>-H</em> Servidor PostGIS</li>
<li><em>-P &lt;puerto&gt;</em> Puerto</li>
<li><em>-U &lt;usuario&gt;</em> Usuario</li>
<li><em>-W</em> pregunta la password del usuario</li>
<li><em>-d &lt;base_de_datos&gt;</em> base de datos de destino</li>
<li><em>-a</em> añade datos a las tablas importadas anteriormente</li>
<li><em>-l</em> almacena las coordenadas en latitud/longitug en lugar de Spherical Mercator</li>
<li><em>-s</em> utiliza tablas secundarias para la importación en lugar de hacerlo en memoria</li>
<li><em>-S &lt;fichero_de_estilos&gt;</em> ruta al fichero que indica las etiquetas de OSM que se quiere importar</li>
<li><em>-v</em> modo verborrea, muestra la salida de las operaciones por consola</li>
</ul>
</div></blockquote>
<p>En caso de no disponer del SRID 900913 en nuestro PostGIS podremos utilizar la definición que hay de él en <tt class="docutils literal"><span class="pre">osm2pgsql</span></tt>. Simplemente ejecutaremos el script 900913.sql</p>
</div>
<div class="section" id="id2">
<h3>Práctica<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">TODO</p>
</div>
</div></blockquote>
</div>
<div class="section" id="osmosis">
<h3>osmosis<a class="headerlink" href="#osmosis" title="Permalink to this headline">¶</a></h3>
<p>Esta herramienta también realiza la importación de datos desde OSM a PostGIS, pero a diferencia de la anterior, esta mantiene las relaciones entre los objetos de OSM importados. Se recomienda acudir a la documentación de la herramienta para comprender mejor su uso.</p>
</div>
</div>
<div class="section" id="consulta-mediante-visores-web-y-sig-escritorio">
<h2>Consulta mediante visores web y SIG escritorio<a class="headerlink" href="#consulta-mediante-visores-web-y-sig-escritorio" title="Permalink to this headline">¶</a></h2>
<p>Mediante el uso de diferentes Software tanto de escritorio como de entorno web, accederemos a los datos que hemos importado y podremos tanto visualizarlos como crear servicios web adaptados de estos datos.</p>
<div class="section" id="id3">
<h3>Práctica<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">TODO</p>
</div>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Importación y exportación de datos</a><ul>
<li><a class="reference internal" href="#importacion-esri-shapes-mediante-shp2pgsql">Importación ESRI shapes mediante shp2pgsql</a><ul>
<li><a class="reference internal" href="#practica">Práctica</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exportacion-desde-pg-a-archivos-de-tipo-esri-shapefile">Exportación desde PostGIS a archivos de tipo ESRI Shapefile</a><ul>
<li><a class="reference internal" href="#id1">Práctica</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gdal-ogr">GDAL/OGR</a><ul>
<li><a class="reference internal" href="#ogrinfo">ogrinfo</a></li>
<li><a class="reference internal" href="#ogr2ogr">ogr2ogr</a></li>
</ul>
</li>
<li><a class="reference internal" href="#importacion-datos-osm-a-postgis">Importación datos OSM a PostGIS</a><ul>
<li><a class="reference internal" href="#osm2pgsql">osm2pgsql</a></li>
<li><a class="reference internal" href="#id2">Práctica</a></li>
<li><a class="reference internal" href="#osmosis">osmosis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#consulta-mediante-visores-web-y-sig-escritorio">Consulta mediante visores web y SIG escritorio</a><ul>
<li><a class="reference internal" href="#id3">Práctica</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="indexacion_espacial.html"
                        title="previous chapter">Indexación espacial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="analisis_espacial.html"
                        title="next chapter">Análisis espacial</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/importacion_exportacion.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="analisis_espacial.html" title="Análisis espacial"
             >next</a> |</li>
        <li class="right" >
          <a href="indexacion_espacial.html" title="Indexación espacial"
             >previous</a> |</li>
        <li><a href="index.html">Curso PostGIS &amp; GeoNetwork 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Micho García.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>